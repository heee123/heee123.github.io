---
layout: post
title:  "LEGO LOAM论文阅读"
date:   2022-12-30 08:50:30 +0800
categories: SLAM
---
# LEGOLOAM  可变形地面的轻量级和地面优化的雷达里程计和建图算法

## 前言

本论文以LOAM为基础，优化了LOAM中存在的一些缺点，并提升其性能。

在LOAM中，特征提取阶段需要计算点云所有点的平滑度值，导致计算量很大，且草地、树叶等环境物体会产生不可靠的特征。

针对这个问题，LEGO-LOAM首先对点云进行地面提取，将点云分为地面点和非地面点。之后对于非地面点，再进行聚类分割。在地面点和分割点中分别提取特征。这样一来，特征提取效率和提取精度得到了提高。

此外，LEGO-LOAM在里程估计阶段采用两步LM优化方法来优化位姿，在不降低精度的情况下降低了优化用时。

## 摘要

提出了轻量级和地面优化的雷达里程计和建图算法LEGO-LOAM。轻量级：其可在嵌入式系统上实现实时位姿估计。地面优化的：其在分割和优化步骤中利用了地面的存在。首先采用点云分割滤除噪声，然后提取边缘特征和平面特征。之后进行两步的LM优化算法来求解六自由度位姿变换的不同分量。实验比较了本方法和LOAM的性能，从可变形环境中收集数据，实验表明本方法在减少计算开销的情况下达到了相近甚至更好的精度。还将LEGO-LOAM集成到SLAM框架中，消除漂移引起的位姿估计误差，并使用KITTI数据集进行测试。

## I 简介

主要介绍一些背景知识，已经算法的基础：LOAM。

SLAM是机器人的基本功能……

SLAM方面，视觉和激光雷达都有大量工作……

视觉在回环检测方面具有优势，但其对光照和视点变化具有敏感性……

激光雷达在夜间也可以工作，精度高，远距离捕捉环境细节……

因此本文研究利用激光雷达来实现SLAM……

ICP方法，计算成本过高……

LOAM方法……

## II 系统硬件

![1659169297186](../../../../image/LEGOLOAM阅读/1659169297186.png)

作者采用这样的一个UGV小车搭载Velodyne VLP-16激光雷达和一个IMU来作为主要的实验平台。从最后的实验来看，不少实验都是在草地和较多树木的环境中进行的，这也是LEGO-LOAM相对于LOAM主要优化的场景。

## III 轻量级雷达里程计和建图算法

这是论文的核心部分，介绍了整个算法的大致流程以及相对于LOAM改进的主要方面

### A 系统概述

![1659169419299](image/LEGOLOAM阅读/1659169419299.png)

本系统是一个雷达里程计算法，因此输入为雷达点云，输出为机器人当前6自由度位姿的估计。

整个系统分为五个模块：

首先是**分割（Segmentation）**，将单个的点云投影到距一个离图像上进行分割（分割地面点与聚类）。

分割后的点云进行**特征提取（Feature Extraction）**，采用与LOAM中类似的方法，根据点的平滑度值提取出边缘点和平面点。

**里程计算法（Lidar Odometry）**使用提取的特征在连续帧之间找到匹配关系，采用LM方法优化求解位姿变换。

**建图算法（Lidar Mapping）**通过scan to map的方法，将当前位姿与一个子地图进行匹配，优化求解更精确的位姿。

最后，**位姿集成模块（Transform Integration）**融合里程计算法和建图算法的输出，发布最终的位姿结果。

### B 分割

令$P_t = \{p_1, p_2, ..., p_n\}$为t时刻获取的点云，将$P_t$投影到距离图像上，这个距离图像的分辨率是1800×16。因为VLP-16有16条线，每条线扫描一圈有1800个点。投影之后，$P_t$中每个点$p_i$由唯一一个像素表示。$p_i$的像素值即表示点$p_i$到传感器的欧氏距离。
由于斜坡地形很常见，因此我们不假设地面是水平的。在分割前，首先对距离图像进行地平面的估计，标记的地面点不用于后续的聚类分割。
在代码中，地平面的提取这样实现：首先假定激光雷达VLP-16只有下面的8条线可能扫到地面，因此只在这8条线中提取地面点。对距离图像（只有下面8行的距离图像）中的每一列，计算上下相邻两个点相对于水平面的夹角，夹角若夹角足够小，则认为这两个点是地面点。

![1660600023536](image/LEGOLOAM阅读/1660600023536.png)

然后，对除地面点外的其余点，应用基于图像的分割方法，将点分割到多个簇中，来自同一簇的点被分配一个唯一的标签。对点云进行分割可以提高处理效率和特征提取精度，因为机器人工作环境中，小物体或树叶等可能形成不可靠的特征。为了之后进行快速可靠的特征提取，省略小于30个点的聚类。

聚类过程在代码中的实现是这样的：从距离图像中的一个点开始，采用广度优先搜索方法（DFS），按顺序检查中心点与上下左右四个点是否为同一类（判断标准为tan∠OAB值的大小），依次向外查找，直到周围没有新的同类点，即表明同一类查找完成。检查本类点的数目是否大于设定的阈值（30个），并且对同类的所有点赋予同一个标签值。之后，选取未查找过的下一个点，继续进行上述DFS查找同类点的过程。

![1660600626447](image/LEGOLOAM阅读/1660600626447.png)

下图为原始点云(a)，在(b)中，红色点为地面点云，其他的彩色点表示不同的聚类点。在(c)中，蓝色和黄色点表示边缘点和平面点。在(d)中，绿色和粉色点表示次级边缘点和平面点。（这里的边缘点（平面点）和次级边缘点（平面点）为下文中特征提取后的点）

![1659170521075](image/LEGOLOAM阅读/1659170521075.png)

此过程之后，只保留了可能代表大型物体的点，距离图像中也只保留这些点，同时，每个点有三个属性：（1）作为地面点或分割点的标签；（2）在距离图像中的位置；（3）距离值。

### C 特征提取

特征提取与LOAM中的方法类似，但没有从原始点云中提取特征，而是从地面点和分割点中提取特征。

首先通过距离值来计算各点平滑度c。

$$
c = \frac{1}{|S|\cdot\|r_i\|}\|\sum_{j \in S, j\neq i}(r_j - r_i)\|
$$

为均匀提取特征，将距离图像水平分为若干（6个，300×16）相等的子图像。在每个子图像中，按照平滑度值c进行排序。使用阈值来区分不同类型的特征，大于阈值的为边缘特征点，小于阈值的为平面特征点。

$\bar{F}_e$次级边缘点集40个，c值最大，不属于地面

$\bar{F}_p$次级平面点集80个，c值最小，属于地面或属于分割点

$F_e$边缘点集2个，c值最大，不属于地面

$F_p$平面点集4个，c值最小，属于地面

### D 里程估计

标签匹配采用与LOAM中相同的方法，对当前帧的每个边缘点（平面点），在上一帧的次级边缘点集（平面点集）中，寻找两个（三个）点，构成对应的边线（平面），构造点到直线（平面）的距离方程，以最小化距离为目标作为待优化的方程。

提高特征匹配精度和效率的方法：

（1）标签匹配：分别匹配，地面点和地面点匹配，分割点和分割点匹配。

（2）两步L-M优化，首先根据平面特征的匹配优化得到$[t_z, \theta_{roll}, \theta_{pitch}]$，之后匹配边缘特征得到$[t_x, t_y, \theta_{yaw}]$。虽然第一步中也会得到$[t_x, tx-y, \theta_{yaw}]$，但其精度不高，不用于第二步。最后融合两步的结果，生成最终的位姿。

本两步LM优化方法在时间减少35%的情况下，可以得到类似精度。

![1660602724214](image/LEGOLOAM阅读/1660602724214.png)

### E 建图

上一步得到的位姿与其对应的特征点集分别对应，作为关键帧应用于建图步骤。

**如果不使用回环检测**，将当前帧点云位姿附近一定范围（采用KDtree查找）的关键帧作为子地图，与当前扫描帧进行scan to map匹配，并优化求解位姿。

之后构建一个位姿图，节点为每一关键帧的位姿，边为位姿之间优化求解得到的位姿变换。

最后图优化求解最终的位姿。

**如果使用回环检测**，在子地图构建部分，只选取时间上接近的点构成子地图。

使用另一线程进行回环检测，对当前帧，在历史关键帧里寻找距离最为接近且时间足够远的关键帧，作为回环帧。采用ICP匹配得到当前帧与回环帧之间的位姿变换，作为约束添加到位姿图中。

## 实验结果

论文这里比对了与LOAM的结果与性能，在较大的草地、小路、树木等环境中进行实验，检验了建图效果和误差，比较了运行时间。
